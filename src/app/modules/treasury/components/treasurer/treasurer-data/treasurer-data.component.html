<app-form-sidenav-right (closeEmitted)="closeSidenav()" #sidenavRight></app-form-sidenav-right>
<app-layout-data>
  <div space-type="header" fxLayout="column">
    <div class="margin-top-small" fxLayout="row" fxLayoutAlign="space-between">
      <h2 class="title" *ngIf="!searchButton">Lista de Tesoureiros</h2>
      <mat-form-field *ngIf="searchButton" fxFlex>
        <input matInput placeholder="Pesquisar..." (keyup)="search$.next($event.target.value)" (blur)="search$.next($event.target.value)"
          [value]="search$ | async">
      </mat-form-field>
      <div class="buttons" fxLayoutAlign="start center">
        <button mat-icon-button (click)="searchButton = !searchButton">
          <mat-icon aria-label="Pesquisar Tesoureiro">search</mat-icon>
        </button>
        <button mat-icon-button matTooltip="Filtragem avançada" (click)="expandPanel(matExpansionPanel)">
          <mat-icon aria-label="Filtragem avançada">filter_list</mat-icon>
        </button>
      </div>
    </div>
    <mat-accordion class="example-headers-align" #matExpansionPanel>
      <mat-expansion-panel #matExpansionPanel hideToggle="true">
        <div fxLayout.gt-xs="row" fxLayout="column">
          <app-filter flex="35" [data]="districtsData" placeholder="Distritos" (filterEmitted)="checkDistrict($event)"></app-filter>
          <app-filter flex="35" [data]="analystsData" placeholder="Analistas" (filterEmitted)="checkAnalyst($event)"></app-filter>
          <app-filter flex="35" [data]="functionsData" placeholder="Cargos" (filterEmitted)="checkFunction($event)"></app-filter>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
    <mat-divider></mat-divider>
    <div class="header">
      <mat-list>
        <mat-list-item>
          <h3 matLine fxLayout="row">
            <span fxFlex fxFlex.gt-sm="40%">Nome do tesoureiro</span>
            <span fxFlex="20%" fxHide.lt-sm>Igreja</span>
            <span fxFlex="20%" fxHide.lt-sm>Cargo</span>
            <span fxFlex="20%" fxHide.lt-sm>Última edição</span>
          </h3>
        </mat-list-item>
      </mat-list>
      <mat-divider></mat-divider>
    </div>
  </div>
    <div space-type="container" fxLayout="column" class="container" infiniteScroll [infiniteScrollDistance]="2" [infiniteScrollThrottle]="50" (scrolled)="onScroll()" [scrollWindow]="false">
    <mat-accordion>
      <div *ngFor="let treasurer of treasurers; index as i">
        <mat-expansion-panel hideToggle *ngIf="i <= showList">
          <mat-expansion-panel-header>
            <mat-panel-description fxLayout="row" fxFlex>
              <span fxFlex fxFlex.gt-sm="40%" style="white-space: line-wrap;">
                {{ treasurer.name }}
              </span>
              <span fxFlex="20%" fxHide.lt-sm fxFlexAlign="center" style="white-space: line-wrap;">
                {{ treasurer.church.name }}
              </span>
              <span fxFlex="20%" fxHide.lt-sm fxFlexAlign="center" style="white-space: line-wrap;">
                {{ treasurer.functionName }}
              </span>
              <span fxFlex="20%" fxHide.lt-sm style="text-align: center">
                {{ treasurer.dateLastEdition | date: "dd/MM/yyyy" }}
              </span>
            </mat-panel-description>
          </mat-expansion-panel-header>
          <div fxLayout="column" class="description">
            <div fxLayout="row">
              <p class="title-description">Informações do Tesoureiro</p>
            </div>
            <div fxLayout="row wrap" fxLayoutGap="5px" fxHide.gt-xs>
              <span class="text-bold">Igreja:</span>
              <span>{{ treasurer.church.name }}</span>
            </div>
            <div fxLayout="row wrap" fxLayoutGap="5px" fxHide.gt-xs>
              <span class="text-bold">Cargo:</span>
              <span>{{ treasurer.functionName }}</span>
            </div>
            <div fxLayout="row wrap" fxLayoutGap="5px" fxHide.gt-xs>
              <span class="text-bold">Última edição:</span>
              <span>{{ treasurer.dateLastEdition | date: "dd/MM/yyyy" }}</span>
            </div>
            <div fxLayout="row wrap" fxLayoutGap="5px" fxHide.gt-xs>
              <span class="text-bold">Email:</span>
              <span>{{ treasurer.email || "Não Informado" }}</span>
            </div>
            <div fxLayout="row wrap" fxLayoutGap="5px">
              <span class="text-bold">Tempo no Cargo:</span>
              <ng-container *ngIf="treasurer.dateRegister; else dateIsNull">
                <span>{{ treasurer.dateRegister | date: "dd/MM/yyyy" }} {{ " - Aproximadamente " + treasurer.dateRegisterFormatted
                  }}</span>
              </ng-container>
              <ng-template #dateIsNull>
                <span>Não Informado</span>
              </ng-template>
            </div>
            <div fxLayout="row wrap" fxLayoutAlign="space-between" fxLayoutGap="15px">
              <div class="box-description" fxLayout="column wrap" fxFlex>
                <p class="text-bold">Endereço:</p>
                <mat-divider></mat-divider>
                <div class="container-description" fxLayout="column" fxLayoutAlign="space-between">
                  <div>{{ treasurer.address || "Não Informado" }}</div>
                  <div fxLayout="row wrap" fxLayoutGap="5px">
                    <span class="text-bold">Complemento:</span>
                    <span *ngIf="treasurer.addressComplement">{{ treasurer.addressComplement || "Não Informado" }}</span>
                  </div>
                  <div fxLayout="row wrap" fxLayoutGap="5px">
                    <span class="text-bold">CEP:</span>
                    <span>{{ treasurer.cep || "Não Informado" }}</span>
                  </div>
                </div>
              </div>
              <div class="box-description" fxLayout="column wrap" fxFlex>
                <p class="text-bold">Telefone(s):</p>
                <mat-divider></mat-divider>
                <ng-container *ngIf="treasurer.phones.length !== 0; else notContaisPhones">
                  <div class="container-description" *ngFor="let phone of treasurer.phones">
                    <div fxLayout="row wrap" fxLayoutGap="5px">
                      <span class="text-bold">{{ phone.type }}:</span>
                      <span>{{ phone.number }}</span>
                      <span> - Serviço(s) Utilizado(s): {{ !phone.isWhatsapp && !phone.isTelegram ? 'Nenhum serviço utilizado.':
                        '' }} {{ phone.isWhatsapp ? 'Whatsapp' : ''}} {{ phone.isWhatsapp && phone.isTelegram ? ', ' : ''}}
                        {{ phone.isTelegram ? 'Telegram': ''}}</span>
                    </div>
                  </div>
                  <div fxLayout="row wrap" fxLayoutGap="5px">
                    <p class="text-bold">Melhor Contato:</p>
                    <p>{{ treasurer.contact || "Não Informado" }}</p>
                  </div>
                </ng-container>
                <ng-template #notContaisPhones>
                  <p>Nenhum Telefone Informado</p>
                </ng-template>
              </div>
            </div>
          </div>
          <mat-action-row fxLayout="row" fxLayout.xs="column">
            <ng-template [Feature]="49" permission="1">
              <button mat-button style="background-color: #ff9800!important; color: #fff" matTooltip="Ver observações" [routerLink]="['/tesouraria/observacoes']">OBSERVAÇÕES</button>
            </ng-template>
            <ng-template [Feature]="38" permission="4">
              <button mat-button color="warn" matTooltip="Excluir Tesoureiro" (click)="removeTreasurer(treasurer)">REMOVER</button>
            </ng-template>
            <ng-template [Feature]="38" permission="3">
              <button mat-button color="primary" matTooltip="Editar Tesoureiro" (click)="editTreasurer(treasurer)">EDITAR</button>
            </ng-template>
          </mat-action-row>
        </mat-expansion-panel>
      </div>
    </mat-accordion>
  </div>
</app-layout-data>
<ng-template [Feature]="38" permission="1">
  <button mat-fab color="accent" class="mat-fab-right" routerLink="./novo">
    <mat-icon aria-label="Adicionar tesoureiro">add</mat-icon>
  </button>
</ng-template>
