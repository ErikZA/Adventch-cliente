<mat-sidenav fxLayout="column" #sidenavRight mode="side" align="end" class="sidenav-right mat-elevation-z4" (keydown.esc)="closeSidenav()" [class.mat-drawer-opened]="sidenavRight.opened" [class.mat-drawer-closed]="!sidenavRight.opened">
    <button mat-icon-button type="button" matTooltip="Fechar" (click)="closeSidenav()">
    <mat-icon>clear</mat-icon>
</button>
    <div>
        <router-outlet></router-outlet>
    </div>
</mat-sidenav>
<div class="page-container mat-elevation-z2" fxFlex fxLayoutAlign="center" style="overflow: auto;">
    <div fxFlex="95%">
        <div class="margin-top-small" fxLayout="row" fxLayoutAlign="space-between">
            <h2 class="title" *ngIf="!searchButton">Lista de Igrejas</h2>
            <mat-form-field *ngIf="searchButton" fxFlex>
                <input matInput placeholder="Pesquisar..." (keyup)="search$.next($event.target.value)" (blur)="search$.next($event.target.value)" [value]="search$ | async">
            </mat-form-field>
            <div class="buttons" fxLayoutAlign="start center">
                <button mat-icon-button (click)="searchButton = !searchButton">
          <mat-icon aria-label="Pesquisar Tesoureiro">search</mat-icon>
        </button>
                <button mat-icon-button matTooltip="Filtragem avançada" (click)="expandPanel(matExpansionPanel)">
          <mat-icon aria-label="Filtragem avançada">filter_list</mat-icon>
        </button>
            </div>
        </div>
        <mat-accordion class="example-headers-align" #matExpansionPanel>
            <mat-expansion-panel #matExpansionPanel hideToggle="true">
                <div fxLayout="row wrap" style="flex-wrap: wrap;">
                    <mat-list flex="35" class="margin-search" style="padding: 0 8px;">
                        <mat-form-field>
                            <mat-select placeholder="Distrito" (change)="search()" [(ngModel)]="filterDistrict">
                                <mat-option [value]="0">TODOS</mat-option>
                                <mat-option *ngFor="let district of districts" [value]="district.id">
                                    {{ district.name }}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </mat-list>
                    <mat-list flex="35" class="margin-search" style="padding: 0 8px;">
                        <mat-form-field>
                            <mat-select placeholder="Cidade" (change)="search()" [(ngModel)]="filterCity">
                                <mat-option [value]="0">TODOS</mat-option>
                                <mat-option *ngFor="let city of cities" [value]="city.id">
                                    {{ city.name }}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </mat-list>
                    <mat-list flex="35" class="margin-search" style="padding: 0 8px;">
                        <mat-form-field>
                            <mat-select placeholder="Analista" (change)="search()" [(ngModel)]="filterAnalyst">
                                <mat-option [value]="0">TODOS</mat-option>
                                <mat-option *ngFor="let analyst of analysts" [value]="analyst.id">
                                    {{ analyst.name }}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </mat-list>
                </div>
            </mat-expansion-panel>
        </mat-accordion>
        <mat-divider></mat-divider>
        <div>
            <div class="header">
                <mat-list>
                    <mat-list-item>
                        <h3 matLine fxLayout="row">
                            <span fxFlex fxFlex.gt-sm="25%">Igreja</span>
                            <span fxFlex fxFlex.gt-sm="25%" fxHide.lt-sm>Distrito</span>
                            <span fxFlex fxFlex.gt-sm="25%" fxHide.lt-sm>Analista</span>
                            <span fxFlex fxFlex.gt-sm="25%" fxHide.lt-sm>Cidade</span>
                        </h3>
                    </mat-list-item>
                </mat-list>
                <mat-divider></mat-divider>
            </div>
            <div class="conteiner" infiniteScroll [infiniteScrollDistance]="1" [infiniteScrollThrottle]="300" (scrolled)="onScroll()" [scrollWindow]="false">
                <mat-accordion>
                    <div *ngFor="let church of churches; index as i">
                        <mat-expansion-panel hideToggle *ngIf="i <= showList">
                            <mat-expansion-panel-header>
                                <mat-panel-description fxLayout="row" fxFlex>
                                    <span fxFlex fxFlex.gt-sm="25%" style="white-space: line-wrap;">
                    {{ church.name }}
                  </span>
                                    <span *ngIf="!church.district.name" fxFlex fxFlex.gt-sm="25%" style="white-space: line-wrap;" fxHide.lt-sm>
                    <i>Não Informado</i>
                  </span>
                                    <span *ngIf="church.district.name" fxFlex fxFlex.gt-sm="25%" style="white-space: line-wrap;" fxHide.lt-sm>
                    {{ church.district.name }}
                  </span>
                                    <span *ngIf="!church.district?.analyst?.name" fxFlex fxFlex.gt-sm="25%" style="white-space: line-wrap;" fxHide.lt-sm>
                    <i>Não Informado</i>
                  </span>
                                    <span *ngIf="church.district?.analyst?.name" fxFlex fxFlex.gt-sm="25%" style="white-space: line-wrap;" fxHide.lt-sm>
                    {{ church.district?.analyst?.name }}
                  </span>
                                    <span fxFlex fxFlex.gt-sm="25%" style="white-space: line-wrap;" fxHide.lt-sm>
                    {{ church.city.name }} - {{ church.city.state.acronym }}
                  </span>
                                </mat-panel-description>
                            </mat-expansion-panel-header>
                            <mat-list>
                                <h3 matSubheader>Informações da igreja</h3>
                                <mat-list-item fxLayout="row" style="height: auto">
                                    <div fxLayout="column" fxFlex matLine>
                                        <span *ngIf="church.district.name" class="details-title" fxLayout.lt-sm="column" fxHide.gt-xs fxLayoutGap.lt-sm="10px"><b>Distrito: </b> {{ church.district.name }}</span>
                                        <span *ngIf="church.district.analyst.name" class="details-title" fxLayout.lt-sm="column" fxHide.gt-xs fxLayoutGap.lt-sm="10px"><b>Analista: </b> {{ church.district?.analyst?.name }}</span>
                                        <span *ngIf="church.city.name" class="details-title" fxLayout.lt-sm="column" fxHide.gt-xs fxLayoutGap.lt-sm="10px"><b>Cidade: </b> {{ church.city.name }} - {{ church.city.state.acronym }}</span>
                                        <span *ngIf="church.code" class="details-title" fxLayout.lt-sm="column"><b>Código:&ensp;</b> {{ church.code }}</span>
                                        <span *ngIf="church.address" class="details-title" fxLayout.lt-sm="column" style="white-space: pre-line; text-overflow: ellipsis;"><b>Endereço:&ensp;</b> {{ church.address }} ({{ church.complement == '' ? 'Sem complemento' : church.complement }})</span>
                                        <span *ngIf="church.cep" class="details-title" fxLayout.lt-sm="column"><b>CEP:&ensp;</b>{{ church.cep }}</span>
                                    </div>
                                </mat-list-item>
                            </mat-list>
                            <mat-action-row>
                                <ng-template [Feature]="48" permission="4">
                                    <button mat-button color="warn" matTooltip="Excluir" (click)="remove(church)">REMOVER</button>
                                </ng-template>
                                <ng-template [Feature]="48" permission="3">
                                    <button mat-button color="primary" matTooltip="Editar" (click)="edit(church)">EDITAR</button>
                                </ng-template>
                            </mat-action-row>
                        </mat-expansion-panel>
                    </div>
                </mat-accordion>
            </div>
        </div>
    </div>
</div>
<ng-template [Feature]="48" permission="1">
    <button mat-fab color="primary" class="mat-fab-right" routerLink="./novo"><mat-icon aria-label="Adicionar">add</mat-icon></button>
</ng-template>