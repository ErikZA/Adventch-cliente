<mat-sidenav fxLayout="column" #sidenavRight mode="side" align="end" class="sidenav-right mat-elevation-z4" (keydown.esc)="closeSidenav()"
  [class.mat-drawer-opened]="sidenavRight.opened" [class.mat-drawer-closed]="!sidenavRight.opened">
  <button mat-icon-button type="button" matTooltip="Fechar" (click)="closeSidenav()">
    <mat-icon>clear</mat-icon>
  </button>
  <div fxFlex fxFlexAlign="center">
    <router-outlet></router-outlet>
  </div>
</mat-sidenav>

<div class="page-container mat-elevation-z2" fxLayoutAlign="center">
  <div fxFlex="95%">
    <div class="margin-top-small" fxLayout="row" fxLayoutAlign="space-between">
      <h2 class="title" *ngIf="!searchButton">Lista de Observações</h2>
      <mat-form-field *ngIf="searchButton" fxFlex>
        <input matInput placeholder="Pesquisar..." (keyup)="search$.next($event.target.value)" (blur)="search$.next($event.target.value)">
      </mat-form-field>
      <div class="buttons" fxLayoutAlign="start center">
        <button mat-icon-button (click)="searchButton = !searchButton">
          <mat-icon aria-label="Pesquisar Tesoureiro">search</mat-icon>
        </button>
        <!-- <button mat-icon-button matTooltip="Filtragem avançada" (click)="expandPanel(matExpansionPanel)">
          <mat-icon aria-label="Filtragem avançada">filter_list</mat-icon>
        </button> -->
      </div>
    </div>
    <!-- <mat-accordion class="example-headers-align" #matExpansionPanel>
      <mat-expansion-panel #matExpansionPanel hideToggle="true">
        <div fxLayout="{{ layout }}" (window:resize)="onResize($event)">
          <mat-list flex="30" class="margin-search" style="padding: 0 8px;">
            <mat-form-field>
              <mat-select placeholder="Distrito" (change)="search()" [(ngModel)]="filterDistrict">
                <mat-option value="0">TODOS</mat-option>
                <mat-option *ngFor="let district of districts" [value]="district.id">
                  {{ district.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </mat-list>
          <mat-list flex="30" class="margin-search" style="padding: 0 8px;">
            <mat-form-field>
              <mat-select placeholder="Cidade" (change)="search()" [(ngModel)]="filterCity">
                <mat-option value="0">TODOS</mat-option>
                <mat-option *ngFor="let city of (cities$ | async ); index as i" [value]="city.id">
                  {{ city.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </mat-list>
          <mat-list flex="30" class="margin-search" style="padding: 0 8px;">
            <mat-form-field>
              <mat-select placeholder="Analista" (change)="search()" [(ngModel)]="filterAnalyst">
                <mat-option value="0">TODOS</mat-option>
                <mat-option *ngFor="let analyst of (analysts$ | async ); index as i" [value]="analyst.id">
                  {{ analyst.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </mat-list>
        </div>
      </mat-expansion-panel>
    </mat-accordion> -->
    <mat-divider></mat-divider>
    <div fxFlex>
      <div class="header">
        <mat-list>
          <mat-list-item>
            <h3 matLine fxLayout="row">
              <span fxFlex fxFlex.gt-sm="35%">Igreja</span>
              <span fxFlex fxFlex.gt-sm="35%">Responsável</span>
              <span fxFlex fxFlex.gt-sm="15%">Data</span>
              <span fxFlex fxFlex.gt-sm="15%">Status</span>
            </h3>
          </mat-list-item>
        </mat-list>
        <mat-divider></mat-divider>
      </div>
      <div class="conteiner" infiniteScroll [infiniteScrollDistance]="1" [infiniteScrollThrottle]="300" (scrolled)="onScroll()"
        [scrollWindow]="false">
        <mat-accordion>
          <div *ngFor="let observation of (observations$ | async ); index as i">
            <mat-expansion-panel hideToggle *ngIf="i <= showList">
              <mat-expansion-panel-header>
                <mat-panel-description fxLayout="row" fxFlex>
                  <span fxFlex fxFlex.gt-sm="35%" style="white-space: line-wrap;">
                    {{ observation.church.name }}
                  </span>
                  <span fxFlex fxFlex.gt-sm="35%" style="white-space: line-wrap;">
                    {{ observation.responsible.name }}
                  </span>
                  <span fxFlex fxFlex.gt-sm="15%" style="white-space: line-wrap;">
                    {{ observation.date | date: "dd/MM/yyyy" }}
                  </span>
                  <span fxFlex fxFlex.gt-sm="15%" style="white-space: line-wrap;">
                    {{ getStatus(observation.status) }}
                  </span>
                </mat-panel-description>
              </mat-expansion-panel-header>
              <mat-list>
                <h3 matSubheader>Informações da observação</h3>
                <mat-list-item>
                  <div fxLayout="row">
                    <div fxFlex>
                      <h4 style="margin: 0 !important">Descrição:</h4>
                    </div>
                    <div fxFlex style="margin: 0 10px;">
                      <span>{{ observation.description }}</span>
                    </div>
                  </div>

                  <div fxLayout="row">
                    <div fxFlex>
                      <h4 style="margin: 0 !important">Tesoureiros:</h4>
                    </div>
                    <div fxFlex style="margin: 0 10px;" *ngFor="let treasurer of observation.treasurers">
                      <span>{{ treasurer.name }}</span>
                    </div>
                  </div>
                  <!-- <div fxLayout="row" fxFlex matLine>
                    <span class="details-title">
                      <b>Tesoureiros:</b>
                    </span>
                    <ul *ngFor="let treasurer of observation.treasurers" fxLayout="column" class="details-title">
                      <li fxFlex style="white-space: pre-line;">{{ treasurer.name }}</li>
                    </ul>
                  </div> -->
                </mat-list-item>
              </mat-list>
              <mat-action-row>
                <button mat-button color="warn" matTooltip="Excluir" (click)="remove(observation)">REMOVER</button>
                <button mat-button color="primary" matTooltip="Editar" (click)="edit(observation)">EDITAR</button>
              </mat-action-row>
            </mat-expansion-panel>
          </div>
        </mat-accordion>
      </div>
    </div>
  </div>
</div>
<button mat-fab color="primary" class="mat-fab-right" routerLink="./novo" (click)="openSidenav()">
  <mat-icon aria-label="Adicionar">add</mat-icon>
</button>
