<mat-sidenav fxLayout="column" #sidenavRight mode="side" align="end" class="sidenav-right mat-elevation-z4" (keydown.esc)="closeSidenav()" [class.mat-drawer-opened]="sidenavRight.opened" [class.mat-drawer-closed]="!sidenavRight.opened">
    <button mat-icon-button type="button" matTooltip="Fechar" (click)="closeSidenav()">
        <mat-icon>clear</mat-icon>
    </button>
    <div>
        <router-outlet></router-outlet>
    </div>
</mat-sidenav>
<div class="page-container mat-elevation-z2" fxLayoutAlign="center">
    <div fxFlex="95%">
        <div class="margin-top-small" fxLayout="row" fxLayoutAlign="space-between">
            <h2 class="title" *ngIf="!searchButton">Lista de Processos</h2>
            <mat-form-field *ngIf="searchButton" fxFlex>
                <input matInput placeholder="Pesquisar..." (keyup)="search$.next($event.target.value)" (blur)="search$.next($event.target.value)">
            </mat-form-field>
            <div class="buttons" fxLayoutAlign="start center">
                <button mat-icon-button (click)="searchButton = !searchButton">
                    <mat-icon aria-label="Pesquisar Processo">search</mat-icon>
                </button>
                <button mat-icon-button (click)="expandPanel(matExpansionPanel)">
                    <mat-icon aria-label="Filtrar lista de processo">filter_list</mat-icon>
                </button>
            </div>
        </div>
        <mat-accordion class="example-headers-align" #matExpansionPanel>
            <mat-expansion-panel #matExpansionPanel hideToggle="true">
                <div fxLayout="{{ layout }}" (window:resize)="onResize($event)">
                    <mat-list flex="auto" class="margin-search" *ngIf="authService.getCurrentUser().idSchool == 0">
                        <h3 mat-subheader style="color: #000">ESCOLAS</h3>
                        <mat-divider></mat-divider>
                        <mat-list-item *ngFor="let s of schools; let i = index">
                            <mat-checkbox style="font-size: 14px; font-weight: 500" [checked]="idSchool + '' == '-1' || s.id + '' == idSchool" (click)="filterBySchool(s.id, i)">({{ s.id }}) {{ s.name }}</mat-checkbox>
                        </mat-list-item>
                    </mat-list>
                    <mat-list flex="auto" class="margin-search">
                        <h3 mat-subheader style="color: #000">STATUS</h3>
                        <mat-divider></mat-divider>
                        <mat-list-item>
                            <mat-checkbox style="font-size: 14px; font-weight: 500" [checked]="scholarshipService.statusSelected == 0 || scholarshipService.statusSelected == 1" (click)="filterByStatus(1)">Aguardando Início</mat-checkbox>
                        </mat-list-item>
                        <mat-list-item>
                            <mat-checkbox style="font-size: 14px; font-weight: 500" [checked]="scholarshipService.statusSelected == 0 || scholarshipService.statusSelected == 2" (click)="filterByStatus(2)">Em Análise</mat-checkbox>
                        </mat-list-item>
                        <mat-list-item>
                            <mat-checkbox style="font-size: 14px; font-weight: 500" [checked]="scholarshipService.statusSelected == 0 || scholarshipService.statusSelected == 3" (click)="filterByStatus(3)">Pendência</mat-checkbox>
                        </mat-list-item>
                        <mat-list-item>
                            <mat-checkbox style="font-size: 14px; font-weight: 500" [checked]="scholarshipService.statusSelected == 0 || scholarshipService.statusSelected == 4" (click)="filterByStatus(4)">Aguardando Vaga</mat-checkbox>
                        </mat-list-item>
                        <mat-list-item>
                            <mat-checkbox style="font-size: 14px; font-weight: 500" [checked]="scholarshipService.statusSelected == 0 || scholarshipService.statusSelected == 5" (click)="filterByStatus(5)">Bolsa Concedida (50%)</mat-checkbox>
                        </mat-list-item>
                        <mat-list-item>
                            <mat-checkbox style="font-size: 14px; font-weight: 500" [checked]="scholarshipService.statusSelected == 0 || scholarshipService.statusSelected == 6" (click)="filterByStatus(6)">Bolsa Concedida (100%)</mat-checkbox>
                        </mat-list-item>
                        <mat-list-item>
                            <mat-checkbox style="font-size: 14px; font-weight: 500" [checked]="scholarshipService.statusSelected == 0 || scholarshipService.statusSelected == 7" (click)="filterByStatus(7)">Indeferida</mat-checkbox>
                        </mat-list-item>
                    </mat-list>
                </div>
            </mat-expansion-panel>
        </mat-accordion>

        <mat-divider></mat-divider>
        <div fxFlex>
            <div class="header">
                <mat-list>
                    <mat-list-item>
                        <h3 matLine fxLayout="row">
                            <div fxLayout="row" fxFlex>
                                <span *ngIf="showSchool"  fxFlex="40%" fxHide.lt-sm>Escola</span>
                                <span fxFlex="50%">Aluno</span>
                                <span fxFlex="150px" fxHide.lt-sm fxFlexAlign="center">Protocolo</span>
                                <span fxFlex="180px" fxHide.lt-sm fxFlexAlign="center">Status</span>
                            </div>
                        </h3>
                    </mat-list-item>
                </mat-list>
                <mat-divider></mat-divider>
            </div>
            <div class="conteiner" infiniteScroll [infiniteScrollDistance]="1" [infiniteScrollThrottle]="300" (scrolled)="onScroll()" [scrollWindow]="false">
                <mat-accordion>
                    <div *ngFor="let process of (processes$ | async ); index as i">
                        <mat-expansion-panel hideToggle *ngIf="i <= showList">
                            <mat-expansion-panel-header>
                                <!-- <mat-panel-title *ngIf="showSchool" fxFlex="38%">
                                    {{ process.student.school.name }}
                                </mat-panel-title> -->
                                <mat-panel-description fxLayout="row" fxFlex>
                                    <span *ngIf="showSchool" fxFlex="38%" style="white-space: nowrap;" fxHide.lt-sm>
                                        {{ process.student.school.name }}
                                    </span>
                                    <span fxFlex="50%" style="white-space: nowrap;">
                                      {{ process.student.name }}
                                    </span>
                                    <span fxFlex="150px" fxHide.lt-sm fxFlexAlign="center">
                                      {{ process.protocol }}
                                    </span>
                                    <span fxFlex="180px" fxHide.lt-sm fxFlexAlign="center">
                                      {{ process.statusString }}
                                    </span>
                                </mat-panel-description>
                            </mat-expansion-panel-header>
                            <mat-list>
                                <h2 matSubheader>Informações do Processo</h2>
                                <mat-list-item fxLayout="row" style="height: auto">
                                    <div fxLayout="column" fxFlex matLine>
                                        <div fxLayout="row" fxHide.gt-xs fxLayoutAlign="space-between">
                                            <span class="text-bold" class="details-title"><b>Escola:</b> {{ process.student.school.name }}</span>
                                        </div>
                                        <div fxLayout="row" fxHide.gt-xs fxLayoutAlign="space-between">
                                            <span class="text-bold" class="details-title"><b>Protocolo:</b> {{ process.protocol }}</span>
                                        </div>
                                        <div fxLayout="row" fxHide.gt-xs fxLayoutAlign="space-between">
                                            <span class="text-bold" class="details-title"><b>Status:</b> {{ process.statusString }}</span>
                                        </div>
                                        <span class="text-bold" class="details-title" fxLayout.lt-sm="column"><b>Documentos pessoais:</b> {{ process.isPersonalDocuments ? "Enviado" : "Não Enviado" }}</span>
                                        <div *ngFor="let document of process.processDocuments">
                                            <mat-panel-description fxLayout="row" fxFlex>
                                                <span fxFlex="100%" style="white-space: normal; padding: 0 30px 0 30px; font-family: Roboto, 'Helvetica Neue', sans-serif;">
                                                    {{ (document.typeDocument == 1 ? document.name : '') }}
                                                </span>
                                            </mat-panel-description>
                                        </div>
                                        <span class="text-bold" class="details-title" fxLayout.lt-sm="column"><b>Declaração do imposto de renda:</b> {{ process.isIR ? "Enviado" : "Não Enviado" }}</span>
                                        <div *ngFor="let document of process.processDocuments">
                                            <mat-panel-description fxLayout="row" fxFlex>
                                                <span fxFlex="100%" style="white-space: normal; padding: 0 30px 0 30px; font-family: Roboto, 'Helvetica Neue', sans-serif;">
                                                    {{ (document.typeDocument == 2 ? document.name : '') }}
                                                </span>
                                            </mat-panel-description>
                                        </div>
                                        <span class="text-bold" class="details-title" fxLayout.lt-sm="column"><b>Carteira de trabalho:</b> {{ process.isCTPS ? "Enviado" : "Não Enviado" }}</span>
                                        <div *ngFor="let document of process.processDocuments">
                                            <mat-panel-description fxLayout="row" fxFlex>
                                                <span fxFlex="100%" style="white-space: normal; padding: 0 30px 0 30px; font-family: Roboto, 'Helvetica Neue', sans-serif;">
                                                    {{ (document.typeDocument == 3 ? document.name : '') }}
                                                </span>
                                            </mat-panel-description>
                                        </div>
                                        <span class="text-bold" class="details-title" fxLayout.lt-sm="column"><b>Comprovante de rendimentos:</b> {{ process.isIncome ? "Enviado" : "Não Enviado" }}</span>
                                        <div *ngFor="let document of process.processDocuments">
                                            <mat-panel-description fxLayout="row" fxFlex>
                                                <span fxFlex="100%" style="white-space: normal; padding: 0 30px 0 30px; font-family: Roboto, 'Helvetica Neue', sans-serif;">
                                                    {{ (document.typeDocument == 4 ? document.name : '') }}
                                                </span>
                                            </mat-panel-description>
                                        </div>
                                        <span class="text-bold" class="details-title" fxLayout.lt-sm="column"><b>Comprovante de despesas:</b> {{ process.isExpenses ? "Enviado" : "Não Enviado" }}</span>
                                        <div *ngFor="let document of process.processDocuments">
                                            <mat-panel-description fxLayout="row" fxFlex>
                                                <span fxFlex="100%" style="white-space: normal; padding: 0 30px 0 30px; font-family: Roboto, 'Helvetica Neue', sans-serif;">
                                                    {{ (document.typeDocument == 5 ? document.name : '') }}
                                                </span>
                                            </mat-panel-description>
                                        </div>
                                        <span class="text-bold" class="details-title" fxLayout.lt-sm="column"><b>Comprovante acadêmico:</b> {{ process.isAcademic ? "Enviado" : "Não Enviado" }}</span>
                                        <div *ngFor="let document of process.processDocuments">
                                            <mat-panel-description fxLayout="row" fxFlex>
                                                <span fxFlex="100%" style="white-space: normal; padding: 0 30px 0 30px; font-family: Roboto, 'Helvetica Neue', sans-serif;">
                                                    {{ (document.typeDocument == 6 ? document.name : '') }}
                                                </span>
                                            </mat-panel-description>
                                        </div>
                                        <span style="white-space: normal;" *ngIf="process.pendency != null && process.status == 3" class="text-bold" class="details-title"><b>Pendência: </b>{{ process.pendency }} <mat-slide-toggle class="padding-left-medium" [checked]="process.isSendDocument" (change)="sendDocuments($event, process)" color="primary">Documento(s) Enviado(s)</mat-slide-toggle></span>
                                        <span style="white-space: normal;" *ngIf="process.dateRegistration != null && (process.status == 5 || process.status ==6)" class="text-bold" class="details-title"><b>Matrícula: </b> até {{ process.dateRegistration | date: "dd/MM/yyyy" }}</span>
                                        <span style="white-space: normal;" *ngIf="process.motiveReject != null && (process.status == 7)" class="text-bold" class="details-title"><b>{{ process.motiveReject }}: </b>{{ getMotiveToReject(process.motiveReject) }}</span>
                                    </div>
                                </mat-list-item>
                            </mat-list>
                            <mat-action-row>                                
                                <button *ngIf="process.status == 1 && authService.getCurrentUser().idSchool == 0" mat-button style="background-color: #76d275!important; color: #fff" matTooltip="Iniciar" (click)="toWaiting([process])">INICIAR</button>
                                <button *ngIf="authService.getCurrentUser().idSchool == 0 && (process.status == 2 || process.status == 3)" mat-button style="background-color: #f44336!important; color: #fff" matTooltip="Pendência" (click)="toPendency([process])">PENDÊNCIA</button>
                                <button *ngIf="authService.getCurrentUser().idSchool == 0 && (process.status > 1 && process.status < 7)" mat-button style="background-color: #607d8b!important; color: #fff" matTooltip="Indeferir" [matMenuTriggerFor]="menu"><mat-icon>list</mat-icon> INDEFERIR</button>
                                <button *ngIf="authService.getCurrentUser().idSchool == 0 && (process.status === 5 || process.status === 6)" mat-button color="warn" matTooltip="Não Matriculou" (click)="toNotEnroll(process)">NÃO MATRICULOU</button>
                                <mat-menu #menu="matMenu">
                                    <button (click)="toReject([process], 1)" mat-menu-item matTooltip="O perfil global foi analisado e em especial os aspectos pedagógicos levados em conta para o indeferimento.">Acadêmico</button>
                                    <button (click)="toReject([process], 2)" mat-menu-item matTooltip="Indeferido em virtude de pendências junto ao setor financeiro.">Financeiro</button>
                                    <button (click)="toReject([process], 3)" mat-menu-item matTooltip="Indeferido em virtude da renda familiar não se enquadrar no perfil de carência apropriado à avaliação correspondente.">Renda</button>
                                    <button (click)="toReject([process], 4)" mat-menu-item matTooltip="O perfil global foi analisado e em especial os aspectos disciplinares levados em conta para o indeferimento.">Disciplinar</button>
                                    <button (click)="toReject([process], 5)" mat-menu-item matTooltip="Indeferido pela apresentação da documentação inconsistente à análise correspondente.">Documentação</button>
                                </mat-menu>
                                <button *ngIf="authService.getCurrentUser().idSchool == 0 && (process.status > 1)" mat-button style="background-color: #ff9800!important; color: #fff" matTooltip="Aprovar" (click)="toApprove([process])">APROVAR</button>
                                <button *ngIf="process.status == 1" mat-button color="primary" matTooltip="Editar" (click)="editProcess([process])">EDITAR</button>
                                <button style="color: #2094c8" mat-button color="primary" matTooltip="Imprimir protocolo" (click)="generateReport([process])">IMPRIMIR</button>
                            </mat-action-row>
                        </mat-expansion-panel>
                    </div>
                </mat-accordion>
            </div>
            <br/>
        </div>
    </div>
</div>
<br/>