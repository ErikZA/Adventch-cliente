<mat-sidenav fxLayout="column" #sidenavRight mode="side" align="end" class="sidenav-right mat-elevation-z4" (keydown.esc)="closeSidenav()" [class.mat-drawer-opened]="sidenavRight.opened" [class.mat-drawer-closed]="!sidenavRight.opened">
    <button mat-icon-button type="button" matTooltip="Fechar" (click)="closeSidenav()">
      <mat-icon>clear</mat-icon>
  </button>
    <div>
        <router-outlet></router-outlet>
    </div>
</mat-sidenav>
<div class="page-container mat-elevation-z2" fxLayoutAlign="center" [class.auto]="matExpansionPanel.expanded">
    <div fxFlex.gt-sm="95%" fxFlex="97%">
        <div class="margin-top-small" fxLayout="row" fxLayoutAlign="space-between">
            <h2 class="title" *ngIf="!searchButton">Lista de Usuários</h2>
            <mat-form-field *ngIf="searchButton" fxFlex>
                <input matInput placeholder="Pesquisar..." (keyup)="search$.next($event.target.value)" (blur)="search$.next($event.target.value)">
            </mat-form-field>
            <div class="buttons" fxLayoutAlign="start center">
                <button mat-icon-button matTooltip="Pesquisar processo" (click)="searchButton = !searchButton">
                  <mat-icon aria-label="Pesquisar Processo">search</mat-icon>
              </button>
                <button mat-icon-button matTooltip="Filtrar lista de processo" (click)="expandPanel(matExpansionPanel)">
                  <mat-icon aria-label="Filtrar lista de processo">filter_list</mat-icon>
              </button>
            </div>
        </div>
        <mat-accordion class="example-headers-align">
            <mat-expansion-panel #matExpansionPanel hideToggle="true">
                <div fxLayout="column">
                    <mat-list fxLayout="column" class="margin-search">
                        <h3 mat-subheader style="color: #000">MÓDULOS</h3>
                        <mat-divider></mat-divider>
                        <mat-list-item fxLayout="row">
                            <ng-container *ngIf="getModulesUnit().length !== 0; else modulesEmpty">
                                <div fxFlex fxFlexOffset="6%" *ngFor="let module of getModulesUnit()">
                                    <mat-checkbox #checkModules color="primary" (click)="filterModules(module, !checkModules.checked)">{{ getModuleName(module) }}</mat-checkbox>
                                </div>
                            </ng-container>
                            <ng-template #modulesEmpty>
                                <div class="details-title">Nenhum módulo disponível para a unidade atual.</div>
                            </ng-template>
                        </mat-list-item>
                    </mat-list>
                </div>
            </mat-expansion-panel>
        </mat-accordion>

        <mat-divider></mat-divider>
        <div fxFlex>
            <div class="header">
                <mat-list>
                    <mat-list-item>
                        <h3 matLine fxLayout="row">
                            <div fxLayout="row" fxLayoutAlign="start center" fxFlex>
                                <span fxFlex.gt-sm="50%" fxFlex>Nome</span>
                                <span fxFlex.gt-md="30%" fxFlex.lt-md="50%" fxHide.lt-sm>E-mail</span>
                                <span fxFlex="18%" fxHide.lt-md>Aniversário</span>
                            </div>
                        </h3>
                    </mat-list-item>
                </mat-list>
                <mat-divider></mat-divider>
            </div>
            <div class="conteiner" layout="column" infiniteScroll [infiniteScrollDistance]="1" [infiniteScrollThrottle]="300" (scrolled)="onScroll()" [scrollWindow]="false">
                <mat-accordion>
                    <div *ngFor="let user of (users$ | async ); index as i">
                        <mat-expansion-panel hideToggle *ngIf="i <= showList">
                            <mat-expansion-panel-header>
                                <mat-panel-description fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px" fxFlex>
                                    <span fxFlex.gt-sm="50%" fxFlex class="break-line">{{ user.name }}</span>
                                    <span fxFlex.gt-md="30%" fxFlex.lt-md="50%" fxHide.lt-sm class="break-line">{{ user?.email }}</span>
                                    <ng-container *ngIf="user.birthday; else notInformedBirthday">
                                        <span fxFlex="18%" class="break-line" fxHide.lt-md>{{ (user.birthday | date: 'dd/MM/yyyy') }}</span>
                                    </ng-container>
                                    <ng-template #notInformedBirthday>
                                        <span fxFlex="18%" class="break-line" fxHide.lt-md>Não Informado</span>
                                    </ng-template>
                                </mat-panel-description>
                            </mat-expansion-panel-header>
                            <mat-list>
                                <h2 matSubheader>Informações do Usuário</h2>
                                <mat-list-item fxLayout="row" style="height: auto">
                                    <div fxLayout="column" fxFlex matLine>
                                        <div fxFlex class="break-line" fxLayoutGap="5px" fxHide.gt-xs>
                                            <span class="text-bold">E-mail:</span>
                                            <span>{{ user.email }}</span>
                                        </div>
                                        <div fxFlex class="break-line" fxHide.gt-sm>
                                            <ng-container *ngIf="user.birthday; else notInformedBirthdayDetails">
                                                <span class="text-bold">Aniversário:</span>
                                                <span>{{ user.birthday | date: 'dd/MM/yyyy' }}</span>
                                            </ng-container>
                                            <ng-template #notInformedBirthdayDetails>
                                                <span class="text-bold">Aniversário:</span>
                                                <span>Não Informado</span>
                                            </ng-template>
                                        </div>
                                    </div>
                                    <div fxLayout="column" *ngIf="user.profiles !== undefined && user.profiles !== null && user.profiles.length !== 0; else notProfiles" fxFlex matLine>
                                        <div fxFlex class="break-line" fxLayoutGap="5px" *ngFor="let profile of user.profiles">
                                            <span class="text-bold">Papel (módulo):</span>
                                            <span> {{ profile.name }} ({{ getModuleName(profile.software) }})</span>
                                        </div>
                                    </div>
                                    <ng-template #notProfiles>
                                        <p class="text-bold break-line margin-top-small">Nenhum papel cadastrado para o usuário.</p>
                                    </ng-template>
                                </mat-list-item>
                            </mat-list>
                            <mat-action-row>
                                <button mat-button color="warn" matTooltip="Excluir Usuário" (click)="removeUser(user)">REMOVER</button>
                                <button mat-button color="primary" matTooltip="Editar Usuário" (click)="editUser(user)">EDITAR</button>
                            </mat-action-row>
                        </mat-expansion-panel>
                    </div>
                </mat-accordion>
            </div>
        </div>
    </div>
</div>
<button mat-fab color="primary" class="mat-fab-right" [routerLink]="['novo']" (click)="openSidenav()">
    <mat-icon aria-label="Adicionar usuário">add</mat-icon>
</button>